// Generated by CoffeeScript 1.6.1
'use strict';
var App;

App = (function() {

  App.detailsURL = /^#employees\/(\d+)/;

  App.showAlert = function(message, title) {
    if (navigator.notification) {
      return navigator.notification.alert(message, null, title, "OK");
    } else {
      return alert((title ? "" + title + ": " + message : message));
    }
  };

  function App() {
    var _this = this;
    this.store = new MemoryStore(function() {
      return $('body').html(new HomeView(_this.store).render());
    });
    this.route = function() {
      var hash, match;
      hash = window.location.hash;
      if (!hash) {
        if (!_this.homePage) {
          _this.homePage = new HomeView(_this.store).render();
        }
        _this.slidePage(_this.homePage);
        return;
      }
      match = hash.match(App.detailsURL);
      if (!match) {
        return;
      }
      return _this.store.findById(Number(match[1]), function(employee) {
        return _this.slidePage(new EmployeeView(employee).render());
      });
    };
    this.registerEvents = function() {
      var $body, event_begin, event_end, tappable, touchable;
      tappable = 'tappable-active';
      touchable = document.documentElement.hasOwnProperty('ontouchstart');
      event_begin = touchable ? 'touchstart' : 'mousedown';
      event_end = touchable ? 'touchend' : 'mouseup';
      $body = $('body');
      $body.on(event_begin, 'a', function(event) {
        return $(event.target).addClass(tappable);
      });
      $body.on(event_end, 'a', function(event) {
        return $(event.target).removeClass(tappable);
      });
      return $(window).on('hashchange', $.proxy(this.route, this));
    };
    this.registerEvents();
    this.slidePage = function(page) {
      var direction, homepage,
        _this = this;
      if (!this.currentPage) {
        $(page).attr('class', 'page stage-center');
        $('body').append(page);
        this.currentPage = page;
        return;
      }
      $('.stage-right, .stage-left').not('.homePage').remove();
      homepage = page === this.homePage;
      $(page).attr('class', "page stage-" + (homepage ? 'left' : 'right'));
      direction = (homepage ? 'right' : 'left');
      if (!homepage) {
        $('body').empty();
      }
      $('body').append(page);
      return setTimeout(function() {
        $(_this.currentPage).attr('class', "page transition stage-" + direction);
        $(page).attr('class', 'page stage-center transition');
        return _this.currentPage = page;
      }, 250);
    };
  }

  return App;

})();
